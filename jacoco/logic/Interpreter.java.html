<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Interpreter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">taschenrechner</a> &gt; <a href="index.source.html" class="el_package">logic</a> &gt; <span class="el_source">Interpreter.java</span></div><h1>Interpreter.java</h1><pre class="source lang-java linenums">package logic;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.function.Predicate;
import java.util.stream.Collectors;

import interfaces.IInterpreter;

<span class="fc" id="L12">public class Interpreter implements IInterpreter {</span>

	// public Strings
	public static final String NUMBER_REGEX = &quot;(\\-)?[0-9]+((\\.){1}[0-9]+)?&quot;;
	public static final String OPERATION_REGEX = &quot;[\\+\\-\\*\\/]&quot;;

	// private Strings
	private static final String INVALID_INPUT = &quot;Invalid Input&quot;;
	private static final String NOT_A_NUMBER = &quot;NaN&quot;;
	private static final String MUL_DIV_REGEX = &quot;[\\*\\/]&quot;;

	// Predicates
<span class="fc" id="L24">	public static final Predicate&lt;String&gt; IS_OPERATION = val -&gt; val.matches(OPERATION_REGEX);</span>
<span class="fc" id="L25">	public static final Predicate&lt;String&gt; IS_NUMBER = val -&gt; val.matches(NUMBER_REGEX);</span>

	@Override
	public List&lt;String&gt; interpret(List&lt;String&gt; input) {
<span class="pc bpc" id="L29" title="1 of 2 branches missed.">		if (!validateSyntax(getText(input))) {</span>
<span class="nc" id="L30">			return Arrays.asList(INVALID_INPUT);</span>
		}
<span class="fc" id="L32">		return solveEquation(Collections.unmodifiableList(input));</span>
	}

	private List&lt;String&gt; solveEquation(List&lt;String&gt; input) {
<span class="fc" id="L36">		List&lt;String&gt; equationWithSolvedMulDiv = solveMulDiv(input);</span>

<span class="fc bfc" id="L38" title="All 2 branches covered.">		if (equationWithSolvedMulDiv.contains(NOT_A_NUMBER)) {</span>
<span class="fc" id="L39">			return equationWithSolvedMulDiv;</span>
		}

<span class="fc" id="L42">		return solveAddSub(equationWithSolvedMulDiv);</span>
	}

	double calculate(String input, double d1, double d2) {
<span class="fc bfc" id="L46" title="All 2 branches covered.">		if (input.contains(&quot;+&quot;)) {</span>
<span class="fc" id="L47">			return d1 + d2;</span>
		}
<span class="fc bfc" id="L49" title="All 2 branches covered.">		if (input.contains(&quot;-&quot;)) {</span>
<span class="fc" id="L50">			return d1 - d2;</span>
		}
<span class="fc bfc" id="L52" title="All 2 branches covered.">		if (input.contains(&quot;*&quot;)) {</span>
<span class="fc" id="L53">			return d1 * d2;</span>
		}
<span class="fc bfc" id="L55" title="All 2 branches covered.">		if (input.contains(&quot;/&quot;)) {</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">			return d2 != 0</span>
<span class="fc" id="L57">					? d1 / d2</span>
<span class="fc" id="L58">					: Double.NaN;</span>
		}
<span class="fc" id="L60">		throw new IllegalArgumentException();</span>
	}

	List&lt;String&gt; solveAddSub(List&lt;String&gt; input) {
<span class="fc" id="L64">		List&lt;Double&gt; numbers = extractNumbers(input);</span>
<span class="fc" id="L65">		List&lt;String&gt; operations = extractOperations(input);</span>
<span class="fc" id="L66">		double result = numbers.get(0);</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">		for (int i = 0; i &lt; operations.size(); i++) {</span>
<span class="fc" id="L68">			result = calculate(operations.get(i), result, numbers.get(i + 1));</span>
		}
<span class="fc" id="L70">		return Arrays.asList(result + &quot;&quot;);</span>
	}

	private List&lt;String&gt; extractOperations(List&lt;String&gt; input) {
<span class="fc" id="L74">		return input.stream()</span>
<span class="fc" id="L75">				.filter(IS_OPERATION)</span>
<span class="fc" id="L76">				.collect(Collectors.toList());</span>
	}

	private List&lt;Double&gt; extractNumbers(List&lt;String&gt; input) {
<span class="fc" id="L80">		return input.stream()</span>
<span class="fc" id="L81">				.filter(IS_NUMBER)</span>
<span class="fc" id="L82">				.map(Double::parseDouble)</span>
<span class="fc" id="L83">				.collect(Collectors.toList());</span>
	}

	List&lt;String&gt; solveMulDiv(List&lt;String&gt; input) {
<span class="fc" id="L87">		List&lt;String&gt; solved = new ArrayList&lt;&gt;(input);</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">		for (int i = 0; i &lt; solved.size(); i++) {</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">			if (solved.get(i).matches(MUL_DIV_REGEX)) {</span>
<span class="fc" id="L90">				double v1 = Double.parseDouble(solved.remove(i - 1));</span>
<span class="fc" id="L91">				double v2 = Double.parseDouble(solved.remove(i));</span>
<span class="fc" id="L92">				String operation = solved.get(i - 1);</span>
<span class="fc" id="L93">				String result = &quot;&quot; + calculate(operation, v1, v2);</span>
<span class="fc" id="L94">				solved.set(i - 1, result);</span>
<span class="fc" id="L95">				i--;</span>
			}
		}
<span class="fc" id="L98">		return Collections.unmodifiableList(solved);</span>
	}

	boolean validateSyntax(String input) {
<span class="fc" id="L102">		return input.matches(NUMBER_REGEX + &quot;(&quot; + OPERATION_REGEX + &quot;{1}&quot; + NUMBER_REGEX + &quot;)*&quot;);</span>
	}

	@Override
	public String getText(List&lt;String&gt; inputs) {
<span class="fc" id="L107">		return inputs.stream().reduce(&quot;&quot;, (acc, val) -&gt; acc += val);</span>
	}

	@Override
	public boolean isOperation(String input) {
<span class="fc" id="L112">		return IS_OPERATION.test(input);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>