<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Interpreter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">taschenrechner</a> &gt; <a href="index.source.html" class="el_package">logic</a> &gt; <span class="el_source">Interpreter.java</span></div><h1>Interpreter.java</h1><pre class="source lang-java linenums">package logic;

import interfaces.IInterpreter;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.function.Predicate;
import java.util.stream.Collectors;

<span class="fc" id="L11">public class Interpreter implements IInterpreter {</span>

  // public Strings
  public static final String NUMBER_REGEX = &quot;(\\-)?[0-9]+((\\.){1}[0-9]+)?&quot;;
  public static final String OPERATION_REGEX = &quot;[\\+\\-\\*\\/]&quot;;

  // private Strings
  private static final String INVALID_INPUT = &quot;Invalid Input&quot;;
  private static final String NOT_A_NUMBER = &quot;NaN&quot;;
  private static final String MUL_DIV_REGEX = &quot;[\\*\\/]&quot;;

  // Predicates
<span class="fc" id="L23">  public static final Predicate&lt;String&gt; IS_OPERATION = val -&gt; val.matches(OPERATION_REGEX);</span>
<span class="fc" id="L24">  public static final Predicate&lt;String&gt; IS_NUMBER = val -&gt; val.matches(NUMBER_REGEX);</span>

  @Override
  public List&lt;String&gt; interpret(List&lt;String&gt; input) {
<span class="pc bpc" id="L28" title="1 of 2 branches missed.">    if (!validateSyntax(getText(input))) {</span>
<span class="nc" id="L29">      return Arrays.asList(INVALID_INPUT);</span>
    }
<span class="fc" id="L31">    return solveEquation(Collections.unmodifiableList(input));</span>
  }

  private List&lt;String&gt; solveEquation(List&lt;String&gt; input) {
<span class="fc" id="L35">    List&lt;String&gt; equationWithSolvedMulDiv = solveMulDiv(input);</span>

<span class="fc bfc" id="L37" title="All 2 branches covered.">    if (equationWithSolvedMulDiv.contains(NOT_A_NUMBER)) {</span>
<span class="fc" id="L38">      return equationWithSolvedMulDiv;</span>
    }

<span class="fc" id="L41">    return solveAddSub(equationWithSolvedMulDiv);</span>
  }

  double calculate(String input, double d1, double d2) {
<span class="fc bfc" id="L45" title="All 2 branches covered.">    if (input.contains(&quot;+&quot;)) {</span>
<span class="fc" id="L46">      return d1 + d2;</span>
    }
<span class="fc bfc" id="L48" title="All 2 branches covered.">    if (input.contains(&quot;-&quot;)) {</span>
<span class="fc" id="L49">      return d1 - d2;</span>
    }
<span class="fc bfc" id="L51" title="All 2 branches covered.">    if (input.contains(&quot;*&quot;)) {</span>
<span class="fc" id="L52">      return d1 * d2;</span>
    }
<span class="fc bfc" id="L54" title="All 2 branches covered.">    if (input.contains(&quot;/&quot;)) {</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">      return d2 != 0 ? d1 / d2 : Double.NaN;</span>
    }
<span class="fc" id="L57">    throw new IllegalArgumentException();</span>
  }

  List&lt;String&gt; solveAddSub(List&lt;String&gt; input) {
<span class="fc" id="L61">    List&lt;Double&gt; numbers = extractNumbers(input);</span>
<span class="fc" id="L62">    List&lt;String&gt; operations = extractOperations(input);</span>
<span class="fc" id="L63">    double result = numbers.get(0);</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">    for (int i = 0; i &lt; operations.size(); i++) {</span>
<span class="fc" id="L65">      result = calculate(operations.get(i), result, numbers.get(i + 1));</span>
    }
<span class="fc" id="L67">    return Arrays.asList(result + &quot;&quot;);</span>
  }

  private List&lt;String&gt; extractOperations(List&lt;String&gt; input) {
<span class="fc" id="L71">    return input.stream().filter(IS_OPERATION).collect(Collectors.toList());</span>
  }

  private List&lt;Double&gt; extractNumbers(List&lt;String&gt; input) {
<span class="fc" id="L75">    return input.stream().filter(IS_NUMBER).map(Double::parseDouble).collect(Collectors.toList());</span>
  }

  List&lt;String&gt; solveMulDiv(List&lt;String&gt; input) {
<span class="fc" id="L79">    List&lt;String&gt; solved = new ArrayList&lt;&gt;(input);</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">    for (int i = 0; i &lt; solved.size(); i++) {</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">      if (solved.get(i).matches(MUL_DIV_REGEX)) {</span>
<span class="fc" id="L82">        double v1 = Double.parseDouble(solved.remove(i - 1));</span>
<span class="fc" id="L83">        double v2 = Double.parseDouble(solved.remove(i));</span>
<span class="fc" id="L84">        String operation = solved.get(i - 1);</span>
<span class="fc" id="L85">        String result = &quot;&quot; + calculate(operation, v1, v2);</span>
<span class="fc" id="L86">        solved.set(i - 1, result);</span>
<span class="fc" id="L87">        i--;</span>
      }
    }
<span class="fc" id="L90">    return Collections.unmodifiableList(solved);</span>
  }

  boolean validateSyntax(String input) {
<span class="fc" id="L94">    return input.matches(NUMBER_REGEX + &quot;(&quot; + OPERATION_REGEX + &quot;{1}&quot; + NUMBER_REGEX + &quot;)*&quot;);</span>
  }

  @Override
  public String getText(List&lt;String&gt; inputs) {
<span class="fc" id="L99">    return inputs.stream().reduce(&quot;&quot;, (acc, val) -&gt; acc += val);</span>
  }

  @Override
  public boolean isOperation(String input) {
<span class="fc" id="L104">    return IS_OPERATION.test(input);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>